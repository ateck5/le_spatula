/*
	Test main module
*/

require('colors');

var config = require('./config.js')

global.testing = function (str) {
	console.log("test ".cyan + str);
};

global.ok = function (str) {
	console.log("ok ".green + str);
};

global.error = function (str) {
	console.log("error ".red + str);
};

var opts = {
	serverid: config.serverid,
	secprotocols: [],
	connectionTimeout: 2 * 60 * 1000,
	loginServer: 'https://play.pokemonshowdown.com/~~' + config.serverid + '/action.php',
	nickName: null,
	pass: null,
	retryLogin: 10 * 1000,
	autoConnect: false,
	autoReconnect: true,
	autoReconnectDelay: 5 * 1000,
	autoJoin: [],
	showErrors: true,
	debug: true
};

global.tests = [
	'./connection.js',
	'./login.js',
	'./disconnect.js'
];

global.curTest = -1;

global.runNextTest = function () {
	curTest++;
	for (var i in TestClient.events) 
		delete TestClient.events[i];
	
	if (!tests[curTest]) {
		ok("test completed - success");
		process.exit();
	}
	
	try {
		require(tests[curTest]);
	} catch (e) {
		error(e.stack);
		process.exit(1);
	}
};

testing("object constructor");
try {
	global.TestClient = require('../lib/index')(config.server, config.port, opts);
	ok("successfully constructed client object");
} catch (e) {
	error("fatal: could not construct client object");
	console.log(e.stack);
	process.exit(1);
}

runNextTest();
