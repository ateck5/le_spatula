/*
	Login test
*/

var timer = setTimeout(function () {
	error("timeout - the test has taken too long");
	process.exit(-2);
}, 60000);

function generateRandomNick (numChars) {
	var chars = 'abcdefghijklmnopqrstuvwxyz0123456789';
	var str = '';
	for (var i = 0, l = chars.length; i < numChars; i++) {
		str += chars.charAt(~~(Math.random() * l));
	}
	return str;
};

TestClient.on('message', function (msg) {
	console.log("recv ".grey + msg);
});

TestClient.on('send', function (msg) {
	console.log("send ".grey + msg);
});

TestClient.on('renamefailure', function (e) {
	if (e === -1)  {
		TestClient.rename(generateRandomNick(8)); 
	} else {
		error('rename failure - login test failed');
		process.exit(-1);
	}
});

TestClient.on('rename', function (name, named) {
	if (named) {
		ok("successfully logged in as " + name);
		ok("login test passed");
		clearTimeout(timer);
		runNextTest();
	}
});

testing("login test");
TestClient.rename(generateRandomNick(8));